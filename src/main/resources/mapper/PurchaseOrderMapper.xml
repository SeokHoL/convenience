<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.saehimit.convenienco.mapper.PurchaseOrderMapper">

    <!-- 발주 헤더 저장 -->
    <insert id="insertPurchaseOrder" parameterType="com.saehimit.convenienco.dto.PurchaseOrderDto">
        INSERT INTO purchase_order (order_id, branch, requester_id, requester_name, status, registered_date, modified_by)
        VALUES (#{orderId}, #{branch}, #{requesterId}, #{requesterName},
                IFNULL(#{status}, '미승인'), NOW(), #{modifiedBy})
    </insert>

    <!-- 발주 정보 조회 -->
    <select id="findPurchaseOrderById" resultType="com.saehimit.convenienco.dto.PurchaseOrderDto">
        SELECT * FROM purchase_order WHERE order_id = #{orderId}
    </select>

    <!-- 전체 발주 목록 조회 -->
    <select id="getAllPurchaseOrders" resultType="com.saehimit.convenienco.dto.PurchaseOrderDto">
        SELECT * FROM purchase_order ORDER BY registered_date DESC
    </select>

    <select id="findByOrderId" resultType="com.saehimit.convenienco.dto.PurchaseOrderDto">
        SELECT * FROM purchase_order WHERE order_id = #{orderId}
    </select>

    <select id="searchPurchaseOrders" parameterType="map" resultType="PurchaseOrderDto">
        SELECT * FROM purchase_order
        WHERE 1=1
        <if test="branch != null and branch != ''">
            AND branch = #{branch}
        </if>
        <if test="orderId != null and orderId != ''">
            AND order_id = #{orderId}
        </if>
        <if test="requesterName != null and requesterName != ''">
            AND requester_name LIKE CONCAT('%', #{requesterName}, '%')
        </if>
    </select>






</mapper>
